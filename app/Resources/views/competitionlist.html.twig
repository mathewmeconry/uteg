{% extends "base_overview.html.twig" %}

{% trans_default_domain 'uteg' %}

{% block title %}{{ 'competitionlist.title'|trans }}{% endblock %}

{% block css %}
    #new {
        margin-top: 10px;
    }

    .icon {
        -webkit-transition: all 300ms cubic-bezier(0.250, 0.100, 0.250, 1.000);
        -moz-transition: all 300ms cubic-bezier(0.250, 0.100, 0.250, 1.000);
        -o-transition: all 300ms cubic-bezier(0.250, 0.100, 0.250, 1.000);
        transition: all 300ms cubic-bezier(0.250, 0.100, 0.250, 1.000); /* ease (default) */

        -webkit-transition-timing-function: cubic-bezier(0.250, 0.100, 0.250, 1.000);
        -moz-transition-timing-function: cubic-bezier(0.250, 0.100, 0.250, 1.000);
        -o-transition-timing-function: cubic-bezier(0.250, 0.100, 0.250, 1.000);
        transition-timing-function: cubic-bezier(0.250, 0.100, 0.250, 1.000); /* ease (default) */

        position: relative;
        text-overflow: clip;
        white-space: nowrap;
        overflow: hidden;
        display: inline-block;
        width: 20px;
        cursor: pointer;
    }

    .action {
        width: 105px;
    }

    .icon-delete-red {
        color: red;
        width: 85px;
    }

    .icon-view-green {
        color: green;
        width: 85px;
    }
{% endblock %}

{% block javascript_docready %}
    $('i[class*="icon-view-"]').click(function() {
        $.ajax({
            url: '/comp/set',
            method: 'POST',
            data: {compid: $(this).parent().parent().data('id')}
        }).success(function(url) {
            if(url) {
                window.location.href = url;
            }
        });
    });

    $('i[class*="icon-delete-"]').click(function() {
    	$( "#dialog-confirm" ).data('compid', $(this).parent().parent().data('id')).dialog('open');
    });

    $('.icon-delete-black').hover(
        function() {
            $(this).removeClass('icon-delete-black').addClass('icon-delete-red');
        },
        function() {
            $(this).removeClass('icon-delete-red').addClass('icon-delete-black');
        }
    );

    $('.icon-view-black').hover(
        function() {
            $(this).removeClass('icon-view-black').addClass('icon-view-green');
        },
        function() {
            $(this).removeClass('icon-view-green').addClass('icon-view-black');
        }
    );
    
    $( "#dialog-confirm" ).dialog({
		resizable: false,
		modal: true,
		autoOpen: false,
		buttons: {
			"{{ 'competitionlist.delcomp.modal.del'|trans }}": function() {
				$.ajax({
					url: '/comp/del',
					method: 'POST',
					data: {compid: $( "#dialog-confirm" ).data('compid')}
				}).success(function(data) {
					(data == 'true') ? window.location.reload() : window.location.reload();
				});
			},
			Cancel: function() {
				$( this ).dialog( "close" );
			}
		}
	});
{% endblock %}

{% block content %}
	<div id="comp">
        <div id="triangle"></div>
        <h1>{{ 'competitionlist.header'|trans }}</h1>
        <div class="content">
            {% for flashMessage in app.session.flashbag.get('success') %}
                <div class="flash-message-success">
                    {{ flashMessage|trans }}
                </div>
            {% endfor %}
            {% for flashMessage in app.session.flashbag.get('error') %}
                <div class="flash-message-error">
                    {{ flashMessage|trans }}
                </div>
            {% endfor %}
            <table>
                <thead>
                    <tr><th>{{ 'competitionlist.form.name'|trans }}</th><th>{{ 'competitionlist.form.gym'|trans }}</th><th>{{ 'competitionlist.form.location'|trans }}</th><th>{{ 'competitionlist.form.zip_code'|trans }}</th><th>{{ 'competitionlist.form.start_date'|trans }}</th><th>{{ 'competitionlist.form.end_date'|trans }}</th><th>{{ 'competitionlist.form.actions'|trans }}</th></tr>
                </thead>
                <tbody>
                    {% for comp in comps %}
                        <tr data-id="{{ comp.id }}"><td>{{ comp.name }}</td><td>{{ comp.gym }}</td><td>{{ comp.location }}</td><td>{{ comp.zipcode }}</td><td>{{ comp.startdate|localizeddate('medium', 'none', app.request.locale) }}</td><td>{{ comp.enddate|localizeddate('medium', 'none', app.request.locale) }}</td><td class="action">{% if is_granted('OWNER', comp) %}<i class="icon icon-delete-black"> {{ 'competitionlist.form.delete'|trans }}</i>{% endif %}<i class="icon icon-view-black"> {{ 'competitionlist.form.view'|trans }}</i></td></tr>
                    {% endfor %}
                </tbody>
            </table>
            <a id="new" class="button" href="/comp/new">{{ 'competitionlist.add_new'|trans }}</a>
        </div>
    </div>
{% endblock %}

{% block dialog %}
	<div id="dialog-confirm" title="{{ 'competitionlist.delcomp.modal.title'|trans }}">
		<p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>{{ 'competitionlist.delcomp.modal.message'|trans }}</p>
	</div>
{% endblock %}